## 22. 인터럽트



#### 폴링과 인터럽트

- 폴링
  - 마이크로프로세서(CPU)가 대상을 주기적으로 감시해 상황이 발생하면 해당 처리 루틴을 실행
    - 상황이 없어도 주기적으로 체크해야 하기 때문에 자원이 낭비될 수 있다.
- 인터럽트
  - 입출력 하드웨어 등의 장치나 예외상황이 발생하여 처리가 필요한 경우 CPU에 알려서 처리



#### 인터럽트의 필요 이유

- 선점형 스케쥴러 구현

  - 프로세스가 실행 중에 다른 프로세스가 현재 실행중인 프로세스를 종료하고 CPU를 강제로 점유
    - 시분할 시스템에 적합하다.
    - CPU타임을 쪼개서 프로그램마다 동일한 시간을 사용하도록 나눌 수 있다.

  - 스케줄러가 실행중인 프로세스를 종료하기 위해서 인터럽트가 필요하다.

- IO Device와의 커뮤니케이션
  - 저장매체에서 데이터 처리 완료 시, 중지된 프로세스를 깨워야 한다. (Block state -> ready state)
- 예외 상황 핸들링
  - 입출력 하드웨어 등의 장치에서 예외 상황이 발생하면, 인터럽트를 걸어 CPU는 해당 예외 상황을 먼저 처리해야 한다.



#### 이벤트와 인터럽트

- 인터럽트는 일종의 이벤트



#### 주요 인터럽트

1. 0으로 나누는 코드 실행 (Divide-by-Zero Interrupt)

2. 타이머 인터럽트
   - 선점형 스케줄러를 위해 필요
3. IO 인터럽트



#### 인터럽트의 종류

1. 내부 인터럽트

   - 주로 시스템 내부에서 발생
   - Divide-by-Zero Interrupt
   - 사용자 모드에서 허용되지 않는 명령 또는 공간 접근

2. 외부 인터럽트

   -  주로 하드웨어에서 발생

   - IO 이벤트
   - Timer 이벤트



### 인터럽트와 IDT

##### IDT

- 인터럽트는 미리 정의되어 각각 번호와 실행 코드를 가리키는 주소가 있다.

- Intterupt Descriptor Table
- 시스텀 콜 인터럽트 명령은 0x80이 이미 정의되어 있다.



#### 간단한 인터럽트 실행 과정

- 강제로 코드에 인터럽트 명령을 넣어 CPU에게 실행 명령을 내려야 한다.

- ```assembly
  mov eax, 1
  mov ebx, 0
  int 0x80		// 소프트웨어 인터럽트 명령(시스템 콜 명령)
  ```

  - eax 레지스터에 시스템 콜 번호 할당

  - ebx  레지스터에 시스템 콜에 해당하는 인자값 할당

  - 소프트웨어 인터럽트 명령 호출

    